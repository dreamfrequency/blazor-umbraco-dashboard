@page "/audit"
@rendermode InteractiveServer
@inject BlazorUmbracoDashboard.Application.Interfaces.IRepository<BlazorUmbracoDashboard.Domain.Entities.AuditLog> AuditRepo
@inject AutoMapper.IMapper Mapper

<PageTitle>Audit Log</PageTitle>

<h1>Audit Log</h1>

@if (logs is null)
{
    <p>Loading...</p>
}
else if (!logs.Any())
{
    <p>No audit log entries found.</p>
}
else
{
    <table class="table table-striped">
        <thead>
            <tr>
                <th>Time</th>
                <th>Action</th>
                <th>Entity</th>
                <th>Performed By</th>
                <th>Details</th>
            </tr>
        </thead>
        <tbody>
            @foreach (var log in logs.OrderByDescending(l => l.CreatedAt))
            {
                <tr>
                    <td>@log.CreatedAt.ToString("g")</td>
                    <td>@log.Action</td>
                    <td>@log.EntityType</td>
                    <td>@log.PerformedBy</td>
                    <td>@log.Details</td>
                </tr>
            }
        </tbody>
    </table>
}

@code {
    private IReadOnlyList<AuditLogDto>? logs;

    protected override async Task OnInitializedAsync()
    {
        var entities = await AuditRepo.GetAllAsync();
        logs = Mapper.Map<IReadOnlyList<AuditLogDto>>(entities);
    }
}
